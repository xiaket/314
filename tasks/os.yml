---
- name: configure ssh service - absent
  lineinfile:
    path: ~/sshd_config
    regexp: "{{ item }}"
    state: absent
  with_items:
    - '^#.*'
    - '^\s?$'
    - 'X11Forwarding yes'

- name: configure ssh service - present
  lineinfile:
    path: /etc/ssh/sshd_config
    line: "{{ item }}"
    state: present
  with_items:
    - 'AllowUsers pi'
    - 'KbdInteractiveAuthentication no'
    - 'PasswordAuthentication no'
    - 'PubkeyAuthentication yes'
  become: yes

- name: set timezone
  timezone:
    name: "{{ timezone }}"
  become: yes

- name: Update All Packages
  apt:
    update_cache: yes
    upgrade: yes
  become: yes

- name: install packages
  apt:
    name: "{{ apt_packages }}"
    state: present
    install_recommends: no
  become: yes

- name: configure mount points
  mount:
    path: "{{ item.dir }}"
    src: "UUID={{ item.uuid }}"
    fstype: "{{ item.fstype }}"
    state: mounted
    opts: "{{ item.options }}"
  become: yes
  with_items: "{{ mounts }}"

- name: remove profile scripts
  file:
    path: "/etc/profile.d/{{ item }}"
    state: absent
  with_items:
    - bash_completion.sh
    - sshpwd.sh
    - wifi-country.sh
  become: yes
