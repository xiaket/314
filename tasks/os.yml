---
- name: create cache_install_dir
  file:
    state: directory
    path: "{{ install_cache_dir }}"
  become: yes

- name: set timezone
  timezone:
    name: "{{ timezone }}"
  become: yes

- name: Update All Packages
  apt:
    update_cache: yes
    upgrade: yes
  become: yes
  register: package_updates

- name: reboot
  shell: "reboot"
  when: package_updates.changed
  become: yes

- name: install packages
  apt:
    name: "{{ apt_packages }}"
    state: present
    install_recommends: no
  become: yes

- name: configure mount points
  mount:
    path: "{{ item.dir }}"
    src: "LABEL={{ item.label }}"
    fstype: "{{ item.fstype }}"
    state: mounted
    opts: "{{ mount_options }}"
  become: yes
  with_items: "{{ mounts }}"

- name: remove profile scripts
  file:
    path: "/etc/profile.d/{{ item }}"
    state: absent
  with_items:
    - bash_completion.sh
    - sshpwd.sh
    - wifi-country.sh
  become: yes
